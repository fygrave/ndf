var _gflots={};function gflot_selection(c,b,a){gflot=_gflots[c];if(!gflot){return false}return gflot.selectFromTo(b,a)}function GFlot(e){var l=this;var C=e.daily;var v=e.intraday;var z=e.id;var p=e.overview_id;if(e.onSelect){l.onSelect=e.onSelect}var s=60000;var t=60*s;var x=24*t;var g=7*x;_gflots[z]=l;l.$plot=$("#"+z);l.$overview=$("#"+p);for(var I=0;I<C.length;++I){C[I][0]=Math.floor(C[I][0]/x)*x+12*t}var c=["€нвар€","феврал€","марта","апрел€","ма€","июн€","июл€","августа","сент€бр€","окт€бр€","но€бр€","декабр€"];var G=["€нв","фев","мар","апр","май","июн","июл","авг","сен","окт","но€","дек"];function E(N,M,i){if(M&&i&&!e.no_selection){return"<span onclick=\"gflot_selection('"+z+"',"+M+","+i+');">'+N+"</span>"}return N}function D(Q,N,O){var M=[];var R=new Date(Q);R.setUTCDate(R.getUTCDate()-((R.getUTCDay()+1)%7));R.setUTCSeconds(0);R.setUTCMinutes(0);R.setUTCHours(0);var P=R.getTime();do{M.push({xaxis:{from:P,to:P+2*x},color:O});P+=g}while(P<N);return M}function w(Q,N,O){var M=[];var S=new Date(Q);var T=S.getFullYear();do{var P=new Date(T,0,1).getTime();var R=new Date(T+1,0,1).getTime();M.push({xaxis:{from:P,to:R},color:O});T+=2}while(R<N);return M}function a(Q,U){var V=[];var S=new Date(Q);var M=S.getFullYear()*12+S.getMonth();do{var T=Math.floor(M/12);var N=M%12;var R=new Date(T,N,15).getTime();var P=new Date(Math.floor(M/12),M%12,1).getTime();var O=new Date(Math.floor((M+1)/12),(M+1)%12,1).getTime();V.push([R,E(G[N],P,O)]);M++}while(R<U);return V}function u(R,O,P){var N=[];var T=new Date(R);var M=T.getFullYear()*12+T.getMonth();do{var Q=new Date(Math.floor(M/12),M%12,1).getTime();var S=new Date(Math.floor((M+1)/12),(M+1)%12,1).getTime();N.push({xaxis:{from:Q,to:S},color:P});M+=2}while(S<O);return N}function f(Q,O,i){var N=new Date(Q).getFullYear();var M=new Date(O).getFullYear();var P=[];for(var R=N;R<M+1;R++){P.push([new Date(R,i,1).getTime(),E(R.toString())])}return P}function o(Q,O){var N=Math.floor(new Date(Q).getTime()/g);var i=Math.ceil(new Date(O).getTime()/g);var P=[];for(var M=N;M<i+1;M++){var R=new Date(M*g);P.push([R.getTime(),E(n(R.getDate())+"."+n(R.getMonth()+1),(M*7-3)*x,(M*7+3)*x)])}return P}function y(Q,P){var N=Math.floor(new Date(Q).getTime()/x);var i=Math.ceil(new Date(P).getTime()/x);var S=[];for(var T=N;T<i+1;T++){var R=new Date(T*x);var O=T*x,M=(T+1)*x;if(v&&v.length){if(M<v[0][0]){O=0;M=0}}else{O=0;M=0}S.push([R.getTime()+43200000,E(R.getDate()+"."+(R.getMonth()+1),O,M)])}return S}function n(M){if(M<10){return"0"+M}return M}function q(P,M,R){R=R||3*60;var Q=Math.floor(new Date(P).getTime()/R/s);var O=Math.ceil(new Date(M).getTime()/R/s);var N=[];for(var i=Q;i<O+1;i++){var S=new Date(i*R*s);N.push([S.getTime(),E(n(S.getHours())+":"+n(S.getMinutes()))])}return N}function A(O,M,N){var i=[];var P=Math.floor(O/t)*t;do{i.push({xaxis:{from:P,to:P+t},color:N});P+=2*t}while(P<M);return i}var F=[{period:365*x,ticks:function(M,i){return f(M,i,6)},markings:w,tickLength:5,_:""},{period:365*x,ticks:function(M,i){return f(M,i,0)},markings:u,_:""},{period:30*x,ticks:a,markings:u,tickLength:5,_:""},{period:7*x,ticks:o,markings:D,tickLength:5,_:""},{period:x,ticks:y,markings:D,tickLength:5,_:""},{period:3*t,ticks:function(M,i){return q(M,i,3*60)},markings:A,_:""},{period:2*t,ticks:function(M,i){return q(M,i,2*60)},markings:A,_:""},{period:1*t,ticks:function(M,i){return q(M,i,60)},markings:A,_:""},{period:30*s,ticks:function(M,i){return q(M,i,30)},markings:A,_:""},{period:10*s,ticks:function(M,i){return q(M,i,10)},markings:A,_:""},{period:5*s,ticks:function(M,i){return q(M,i,5)},markings:A,_:""},{period:2*s,ticks:function(M,i){return q(M,i,2)},markings:A,_:""},{period:1*s,ticks:function(M,i){return q(M,i,1)},markings:A,_:""},];var r=C[0][0];var h=C[C.length-1][0];if(v&&v.length){h=Math.max(h,v[v.length-1][0])}var d;var b=B("year");if(e.def_range){var m=B(e.def_range)}else{var m=b}var J=B("year_m");if(p){l.overview=$.plot($("#"+p),[C],{series:{color:"#5B5B5B",lines:{show:true,lineWidth:0,fill:true,fillColor:"rgba(0, 0, 0, 0.4)"},shadowSize:0},grid:{markings:u(C[0][0],C[C.length-1][0],"#C7C7C7"),backgroundColor:{colors:["#D9CFAC","#C7C7C7"]}},xaxis:{min:J[0],max:J[1],ticks:a(J[0],J[1]),tickLength:0,mode:"time"},yaxis:{ticks:[],min:0,autoscaleMargin:0.1},selection:{mode:"x",color:"#F76B00"}})}function k(i){if(window.console){console.log(i)}}var j=[[500,500],[200,200],[100,100],[50,50],[20,20],[10,10],[5,5],[2,2],[1,1]];function H(ae,O){var S=O.xaxis.from;var R=O.xaxis.to;var Q,P;var ah=C;var ab=0;if(R-S<x*2&&v&&v.length){ah=v;ab=1}var Z=ah.length;var Y=0;for(var af=0;af<ah.length;++af){if(!ah[af]){continue}var W=ah[af][0];if(W>=S&&W<=R){if(af<Z){Z=af}Y=af}}Y++;Z--;for(var af=Z;af<Y;++af){if(!ah[af]){continue}var V=ah[af][1];if(!Q||V<Q){Q=V}if(!P||V>P){P=V}}var ad=j[0];var X=P-Q;for(var af=1;af<j.length;af++){if(X>j[af][0]){break}ad=j[af]}ad=ad[1];P=Math.ceil(P/ad)*ad;Q=Math.floor(Q/ad)*ad;k(["yscale",ad,P,Q]);if(R-S<1.5*x){if(S<ah[0][0]){S=Math.floor(ah[0][0]/t)*t}if(R>ah[ah.length-1][0]){R=Math.floor(ah[ah.length-1][0]/t)*t+t}}var T=l.$plot.width()-50;var U=35;var N=Math.floor(T/U);var aa=F[0];for(var af=1;af<F.length;af++){if(Math.floor((R-S)/F[af].period)>N){break}aa=F[af]}var ag=aa.ticks(S,R);var ac=aa.markings(S,R);var M=aa.tickLength;l.data=ah;l.plot=$.plot(l.$plot,[ah],{crosshair:{mode:"x"},selection:e.no_selection?{}:{mode:"x",color:"#a7c751"},xaxis:{show:!e.hideXAxis,mode:"time",tickLength:M,min:S,max:R,ticks:ag},yaxis:{show:!e.hideYAxis,position:"right",min:Q,max:P},grid:{hoverable:true,backgroundColor:{colors:["#F8F8F8","#CECECE"]},markings:ac},series:{color:"#960C08",lines:{fill:0.2,show:true,lineWidth:1,fillColor:"rgba(255, 68, 86, 0.2)"},points:{color:"#FFFFFF",fill:0.5,fillColor:"#9E0B0F",show:ab?R-S<t:R-S<60*x,lineWidth:1}}});if(l.overview){l.overview.setSelection(O,true)}if(l.onSelect){return l.onSelect(O)}}l.$plot.bind("plotselected",H);l.$overview.bind("plotselected",function(M,i){l.plot.setSelection(i)});H(null,{xaxis:{from:m[0],to:m[1]}});l.$overview.dblclick(function(){l.plot.setSelection({xaxis:{from:b[0],to:b[1]}})});l.$plot.dblclick(function(){H(null,{xaxis:{from:m[0],to:m[1]}})});function L(i,O,N){var M=$('<div id="tooltip" class="gf_popup"></div>').html('<ul><li class="l1"></li><li class="l2">'+N+'</li><li class="l3"></li></ul><div class="clear"></div></div>').css({position:"absolute",display:"none",top:O+5,left:i+3}).appendTo(document.body).fadeIn(200)}var K=null;l.$plot.bind("plothover",function(N,R,M){if(M){if(K!=M.dataIndex){K=M.dataIndex;$("#tooltip").remove();var i=M.datapoint[0];var Q=M.datapoint[1].toFixed(2);if(e.last_point_only&&i!=l.data[l.data.length-1][0]){return}var P=new Date(i);var O=""+P.getDate()+" "+c[P.getMonth()]+" "+P.getFullYear();if(l.data===v){O+=", "+n(P.getHours())+":"+n(P.getMinutes())}L(M.pageX,M.pageY,O+"<br /><b>"+Q+"<b>")}}else{$("#tooltip").remove();K=null}});l.selectFromTo=function(N,M,i){k("selecting range "+i+": "+[N,M]);H(null,{xaxis:{from:N,to:M},__range:i});return true};function B(M){var N=Math.floor(h/x)*x;switch(M){case"day":return[N,N+x];case"week":return[N-g+x,N+x];case"month":return[N-30*x,h+x];case"year":case"year_m":var O=new Date(h);var P=O.getFullYear();var i=O.getMonth();if(i<12){i++}else{i=0,P++}return[new Date(P-1,i,1).getTime(),new Date(P,i,1).getTime()]}}l.selectLast=function(i){var M=B(i);k("selecting range "+i+": "+M);if(M){return l.selectFromTo(M[0],M[1],i)}};l.setIntraday=function(M){v=M};l.getIntraday=function(){return v};l.setDaily=function(i){C=i};l.getDaily=function(){return C}};